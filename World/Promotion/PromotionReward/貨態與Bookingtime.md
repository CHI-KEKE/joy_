# 貨態與Bookingtime文件

## 目錄
1. [回饋時間設定](#1-回饋時間設定)
2. [N天時間計算](#2-n天時間計算)
3. [逆流程延遲處理](#3-逆流程延遲處理)
4. [Bookingtime時間設定](#4-bookingtime時間設定)
5. [系統性錯誤處理](#5-系統性錯誤處理)
6. [活動期間限制](#6-活動期間限制)

<br>

---

## 1. 回饋時間設定

有分訂單成立 / 訂單完成回饋 N天 / 指定日期

<br>

---

## 2. N天時間計算

+N 天是依據訂單出貨完成後的時間疊加

<br>

會先以訂單成立時間 + N天

<br>

N 天後 SetBookingTime 時檢查貨態：

<br>

**全部完成**：貨態完成時間 + N 天

<br>

**未完成**：當下時間 + N 天 (不是 + 1 天原因是沒有意義，因為最終還是以貨態完成時間 + N 天，因此 N天後檢查仍是以"貨態發現完成時間" + N天)

<br>

確認 Bookingtime 已過，開始回饋

<br>

---

## 3. 逆流程延遲處理

逆流程只會延遲一天

<br>

因為若是訂單完成前叫做取消 => 應該是會直接取消，不會有取消中狀態對我們來說

<br>

若是訂單完成後退貨，但因為是指定日期或 N天導致還沒回饋，那只會是根據已經算好的訂單完成時間 + 1天延遲而已

<br>

---

## 4. Bookingtime時間設定

N 天、指定日期會設定 Bookingtime 為 0:00，目的是為了 6:00 以前要發完，而 1:01 會撈到 0:00 那一波訂單

<br>

---

## 5. 系統性錯誤處理

逆流程 job 比正流程 job 先觸發成功，則會是系統性錯誤要找出正流程的 job 讓他走完

<br>

---

## 6. 活動期間限制

活動進行中不可以修改 N 天的值

<br>