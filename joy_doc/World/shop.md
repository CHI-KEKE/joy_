# 🏪 商店設定開關指南

<br>

## 📖 目錄
  - [🔧 開關類型介紹](#-開關類型介紹)
  - [🧭 設定管理位置](#-設定管理位置)
  - [⚡ ShopStaticSetting vs ShopDefault 選擇指南](#-shopstaticsetting-vs-shopdefault-選擇指南)
  - [📋 使用案例分析](#-使用案例分析)
    - [案例1：依活動建立時間決定程式邏輯](#案例1依活動建立時間決定程式邏輯)
    - [案例2：Stripe 帳戶設定](#案例2stripe-帳戶設定)

<br>

---

## 🔧 開關類型介紹

商店設定開關主要分為兩種類型：

<br>

1. **ShopStaticSetting**
2. **ShopDefault**

<br>

這兩種設定都可以透過 ERP 系統中的「商店自訂開關設定查詢」進行設定和管理。

<br>

---

## 🧭 設定管理位置

所有的商店設定開關都可以在以下位置進行管理：

<br>

**ERP >> 商店自訂開關設定查詢**

<br>

透過此介面可以進行設定值的查詢、新增、修改和管理操作。

<br>

---

## ⚡ ShopStaticSetting vs ShopDefault 選擇指南

在選擇使用 ShopStaticSetting 還是 ShopDefault 時，需要考慮以下因素：

<br>

**ShopStaticSetting 適用情境**：
- 功能行為開關
- 測試開關
- 快速調整的設定項目
- 支援全域控制（ShopId = 0）
- 需要彈性擴充的設定

<br>

**ShopDefault 適用情境**：
- 商業邏輯穩定性要求高
- 第三方系統串接參數
- 需要多維度條件配置
- 嚴格控管的業務設定

<br>

---

## 📋 使用案例分析

### 案例1：依活動建立時間決定程式邏輯

**情境說明**：

<br>

依據「活動建立時間」來決定走新舊程式邏輯的分流控制。

<br>

**考量因素**：

<br>

這樣的設定會直接影響系統執行行為，因此需要具備下列特性：

<br>

✅ 能設定一個全域的基準時間點

✅ 未來可能依活動類型、ShopId 區分

✅ 要可修改，不能寫死在程式碼中

✅ 不常變，但很關鍵，需控管設定值

<br>

**建議方案：放在 ShopStaticSetting**

<br>

| 面向 | 說明 |
|------|------|
| **使用場景** | 控制流程分歧（新制 / 舊制）屬於「功能行為開關」 |
| **變動彈性** | 可能有多種活動類型，未來擴充也方便 |
| **可支援 ShopId = 0** | 現階段可能是全域控制，預留彈性 |
| **命名清晰、可追蹤** | 可以搭配 GroupName 分類，如 `PromotionActivityMigration` |

<br>

**為什麼不建議放在 ShopDefault？**

<br>

| 問題 | 說明 |
|------|------|
| 🧱 通常用來管理業務設定值 | 如：金流上限、開關功能，較少用來設定「邏輯分流時間」 |
| 📦 多了維度（SupplierId）反而增加複雜度 | 並非真正依商店或供應商區分邏輯的設定 |
| ❌ 這種時間點設定不是每間店都不同 | 若統一門檻時間放 ShopDefault 會造成資料重複 |

<br>

### 案例2：Stripe 帳戶設定

**情境說明**：

<br>

| 項目 | 範例值 | 說明 |
|------|--------|------|
| Stripe 帳戶名稱 | acct_1ORWSfIx8j02au5t | 通常是連結到 Stripe 的商店帳號 |
| Stripe 帳戶類型 | CustomTest | 表示這是測試用還是實際生效的帳號 |

<br>

這類設定屬於：

<br>

🔹「特定商店的第三方金流串接參數」

🔹「由開發 / 設定人員提供，不由商戶自行調整」

🔹「可能影響金流流程，需穩定且控管良好」

<br>

**建議方案：放在 ShopDefault**

<br>

| 原因 | 說明 |
|------|------|
| 🔒 商業邏輯穩定性 | Stripe 是實際金流出入的關鍵系統，屬於「商店業務設定」，應嚴格控管設定出處與套用邏輯 |
| 🔄 支援多維度配置 | 一間店可能會有不同 Stripe 帳號（因商務需求），ShopDefault 支援 SupplierId, ShopId 的多維度條件配置 |
| 🧭 結構支援統一套用 | 有 SystemDefaultId 可支援統一套用或匯出，開發時容易串接成設定頁範本與回填 API |

<br>

**不建議放在 ShopStaticSetting 的原因**：

<br>

| 問題 | 說明 |
|------|------|
| ❗ 太彈性，易被誤用 | 任意設定值都能寫入，風險在於會有不一致格式、不同命名、難以管理 |
| ❌ 適合放快速開關、測試開關 | 例如 Stripe.EnableTestMode 比較適合放這裡，但帳號本身要控管風險不宜 |

<br>
